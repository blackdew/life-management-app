<!-- T1-15: ì‹¤ì‹œê°„ ê²€ìƒ‰ ê²°ê³¼ (HTMXìš©) -->
<div class="search-results space-y-3" id="search-results">
    {% if query and query.strip() %}
    <div class="text-sm text-gray-600 mb-4">
        "{{ query }}" ê²€ìƒ‰ ê²°ê³¼
        {% set total_results = search_results.milestones|length + search_results.todos|length %}
        ({{ total_results }}ê°œ)
    </div>

    {% if error %}
    <div class="bg-red-50 border border-red-200 rounded-md p-3">
        <p class="text-red-600 text-sm">{{ error }}</p>
    </div>
    {% endif %}

    {% if search_results.milestones or search_results.todos %}

        <!-- ë§ˆì¼ìŠ¤í†¤ ê²°ê³¼ -->
        {% if search_results.milestones %}
        <div class="space-y-2">
            <h4 class="text-sm font-medium text-gray-900 flex items-center">
                <span class="text-blue-500 mr-2">ğŸ¯</span>
                ë§ˆì¼ìŠ¤í†¤ ({{ search_results.milestones|length }}ê°œ)
            </h4>
            {% for milestone in search_results.milestones %}
            <div class="bg-white border rounded-lg p-3 hover:shadow-sm transition-shadow">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <h5 class="text-sm font-medium text-gray-900 mb-1">
                            {{ milestone.title }}
                        </h5>
                        {% if milestone.description %}
                        <p class="text-xs text-gray-500 mb-2 line-clamp-2">
                            {{ milestone.description }}
                        </p>
                        {% endif %}
                        <div class="flex items-center space-x-3 text-xs text-gray-400">
                            <span>ì‘ì—…: {{ milestone.completed_todos }}/{{ milestone.total_todos }}ê°œ</span>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2 ml-4">
                        <!-- í¸ì§‘ ë²„íŠ¼ -->
                        <button hx-get="/api/milestones/{{ milestone.id }}/edit"
                                hx-target="#modal-content"
                                hx-trigger="click"
                                class="text-gray-400 hover:text-blue-600 p-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                            </svg>
                        </button>
                        <!-- ìƒì„¸ë³´ê¸° -->
                        <a href="/milestones/{{ milestone.id }}"
                           class="bg-blue-100 hover:bg-blue-200 text-blue-700 px-2 py-1 rounded text-xs font-medium">
                            ìƒì„¸ë³´ê¸°
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- TODO ê²°ê³¼ -->
        {% if search_results.todos %}
        <div class="space-y-2">
            <h4 class="text-sm font-medium text-gray-900 flex items-center">
                <span class="text-green-500 mr-2">ğŸ“</span>
                TODO ({{ search_results.todos|length }}ê°œ)
            </h4>
            {% for todo in search_results.todos %}
            <div class="bg-white border rounded-lg p-3 hover:shadow-sm transition-shadow">
                <div class="flex items-start justify-between">
                    <div class="flex items-start space-x-3 flex-1">
                        <!-- ì™„ë£Œ ì²´í¬ë°•ìŠ¤ -->
                        <input type="checkbox"
                               {% if todo.is_completed %}checked{% endif %}
                               hx-put="/api/todos/{{ todo.id }}/complete"
                               hx-target="closest div"
                               hx-swap="outerHTML"
                               class="mt-0.5 h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded">

                        <div class="flex-1">
                            <h5 class="text-sm font-medium text-gray-900 mb-1 {% if todo.is_completed %}line-through text-gray-500{% endif %}">
                                {{ todo.title }}
                            </h5>
                            {% if todo.description %}
                            <p class="text-xs text-gray-500 mb-2 line-clamp-2">
                                {{ todo.description }}
                            </p>
                            {% endif %}
                            <div class="flex items-center space-x-3 text-xs text-gray-400">
                                <span>{{ todo.milestone_title }}</span>
                                {% if todo.is_completed %}
                                <span class="text-green-600">âœ“ ì™„ë£Œ</span>
                                {% else %}
                                <span class="text-orange-600">ì§„í–‰ì¤‘</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center space-x-2 ml-4">
                        <!-- í¸ì§‘ ë²„íŠ¼ -->
                        <button hx-get="/api/todos/{{ todo.id }}/edit"
                                hx-target="#modal-content"
                                hx-trigger="click"
                                class="text-gray-400 hover:text-green-600 p-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

    {% else %}
        <!-- ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ -->
        <div class="text-center py-8">
            <div class="text-gray-400 text-4xl mb-3">ğŸ”</div>
            <p class="text-gray-500 mb-2">
                "{{ query }}"ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
            </p>
            <p class="text-gray-400 text-sm">
                ë‹¤ë¥¸ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰í•´ë³´ì„¸ìš”.
            </p>
        </div>
    {% endif %}

    {% else %}
        <!-- ê²€ìƒ‰ì–´ ì…ë ¥ ì•ˆë‚´ -->
        <div class="text-center py-8">
            <div class="text-gray-300 text-4xl mb-3">ğŸ”</div>
            <p class="text-gray-500 mb-2">
                ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”
            </p>
            <p class="text-gray-400 text-sm">
                ë§ˆì¼ìŠ¤í†¤ê³¼ TODOë¥¼ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </p>
        </div>
    {% endif %}
</div>

<!-- HTMX ë¡œë”© ì¸ë””ì¼€ì´í„° ìŠ¤íƒ€ì¼ -->
<style>
.htmx-request {
    opacity: 0.5;
}

.htmx-indicator {
    display: none;
}

.htmx-request .htmx-indicator {
    display: inline;
}

.htmx-request.htmx-indicator {
    display: inline;
}

/* ê²€ìƒ‰ ê²°ê³¼ ì• ë‹ˆë©”ì´ì…˜ */
.search-results > div {
    animation: fadeIn 0.3s ease-in-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* ë¼ì¸ í´ë¨í”„ */
.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}
</style>